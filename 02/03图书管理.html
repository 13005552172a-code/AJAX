<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .box {
        margin: 40px auto;
        width: 800px;
        height: 600px;
        border: 1px solid #000;
        /* background-color: aqua; */
      }
      .top {
        display: flex;
        justify-content: flex-end;
        padding: 10px;
        text-align: center;
        /* background-color: beige; */
      }
      .right {
        padding-top: 10px;
        margin-left: 580px;
      }
      .right button {
        width: 60px;
        height: 35px;
        border: none;
        border-radius: 10px;
        color: #fff;
        background-color: #4a4ac9;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .right button:hover {
        background-color: #575dda;
      }
    </style>
    <!-- body -->
    <style>
      /* tr {
        background-color: darkgoldenrod;
      } */
      tr th {
        color: #fff;
        border-right: 0.1px solid #fff;
        background-color: darkgoldenrod;
      }
      .xuhao {
        width: 200px;
      }
      .bookname {
        width: 130px;
      }
      .person {
        width: 130px;
      }
      .place {
        width: 130px;
      }
      .act {
        width: 250px;
        border-right: none;
      }
      .trs {
        border-bottom: 1px solid #e28787;
      }
      tr td {
        padding-top: 5px;
        padding-bottom: 5px;
        text-align: center;
        border-bottom: 1px solid #e28787;
      }
      .sb {
        display: flex;
        justify-content: space-around;
      }
      .sb .lefts {
        color: darkorange;
        cursor: pointer;
        transition: color 0.2s;
      }
      .sb .lefts:hover {
        color: rgb(240, 168, 79);
      }
      .sb .rights {
        color: rgb(131, 161, 225);
        cursor: pointer;
        transition: color 0.2s;
      }
      .sb .rights:hover {
        color: rgb(4, 79, 253);
      }
    </style>
    <!-- 添加盒子 -->
    <style>
      .box1 {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 450px;
        height: 320px;
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        padding: 30px 40px;
        position: relative;
      }
      .xs {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 18px;
        cursor: pointer;
        color: #999;
        transition: color 0.2s;
      }
      .xs:hover {
        color: #333;
      }
      .shuru {
        display: flex;
        flex-direction: column;
        gap: 25px; /*垂直间距*/
        margin-top: 10px;
      }
      .form-item input {
        flex: 1;
        min-width: 200px;
        padding: 0 12px;
        border-radius: 4px;
        border: 1px solid #ddd;
        outline: none;
        height: 36px;
        transition: border-color 0.2s;
      }
      .form-item input:hover {
        border-color: #575dda;
      }
      .anjian {
        display: flex;
        justify-content: flex-end; /*右对齐*/
        gap: 12px;
        margin-top: 15px;
      }
      .quxiao {
        width: 80px;
        height: 36px;
        background-color: #f5f5f5;
        color: #666;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .quxiao:hover {
        background-color: #eee;
      }
      .queding {
        width: 80px;
        height: 36px;
        margin-left: 10px;
        background-color: #575dda;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .queding:hover {
        background-color: #4a4ac9;
      }
    </style>
  </head>
  <body>
    <div class="box">
      <div class="top">
        <div class="left"><h1 class="logo">图书管理</h1></div>
        <div class="right">
          <button class="add">+ 添加</button>
        </div>
      </div>
      <div class="body">
        <table>
          <tr>
            <th class="xuhao">序号</th>
            <th class="bookname">书名</th>
            <th class="person">作者</th>
            <th class="place">出版社</th>
            <th class="act">操作</th>
          </tr>
          <tbody class="tbody"></tbody>
        </table>
      </div>
      <div class="box1">
        <div class="xs">X</div>
        <form action="" class="shuru">
          <!-- 给每个表单项加外层容器，确保排版对齐 -->
          <div class="form-item">
            <span>书名</span>
            <input
              type="text"
              class="bookname inputsss"
              name="bookname"
              placeholder="请输入书名"
            />
          </div>
          <div class="form-item">
            <span>作者</span>
            <input
              type="text"
              class="author"
              name="author"
              placeholder="请输入作者"
            />
          </div>
          <div class="form-item">
            <span>出版社</span>
            <input
              type="text"
              class="publisher"
              name="publisher"
              placeholder="请输入出版社"
            />
          </div>
          <div class="anjian">
            <button type="button" class="quxiao">取消</button>
            <button type="button" class="queding">保存</button>
          </div>
        </form>
      </div>
    </div>
    <!-- 获得表单元素的插件 -->
    <script src="../01/form-serialize.js"></script>
    <!-- axios使用 -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      const add = document.querySelector(`.add`);
      const box1 = document.querySelector(`.box1`);
      const quxiao = document.querySelector(`.quxiao`);
      const xs = document.querySelector(`.xs`);
      const show = () => {
        box1.style.display = `block`;
      };
      const def = () => {
        box1.style.display = `none`;
      };
      const creator = `帅哥`;
      // 刷新
      function getBookList() {
        axios({
          url: `https://hmajax.itheima.net/api/books`,
          params: {
            // 传递的是外号
            creator,
          },
        }).then((result) => {
          const booklist = result.data.data;
          // console.log(booklist);
          const listbook = booklist
            .map((item, index) => {
              const { bookname, author, publisher, id } = item;
              return `
          <tr class="trs">
            <td>${index + 1}</td>
            <td>${bookname}</td>
            <td>${author}</td>
            <td>${publisher}</td>
            <td class="sb" data-id=${id}>
              <span class="lefts">删除</span>
              <span class="rights">编辑</span>
            </td>
          </tr>`;
            })
            .join(``);
          // console.log(listbook);
          document.querySelector(`.tbody`).innerHTML = listbook;
        });
      }
      getBookList();
      quxiao.addEventListener(`click`, def);
      xs.addEventListener(`click`, def);
      const save = document.querySelector(`.queding`);
      //
      add.addEventListener(`click`, () => {
        show();
        // 添加数据
        save.addEventListener(`click`, () => {
          // 获取表单
          const forms = document.querySelector(`.shuru`);
          const bookobj = serialize(forms, { hash: true, empty: true });
          console.log(bookobj);
          // 提交到服务器
          axios({
            url: `https://hmajax.itheima.net/api/books`,
            method: `post`,
            data: {
              ...bookobj,
              creator,
            },
          }).then((result) => {
            console.log(result);
            getBookList();
            // 刷新表单
            forms.reset();
            // 隐藏
            def();
          });
        });
      });
      // 删除
      document.querySelector(`.tbody`).addEventListener(`click`, (e) => {
        if (e.target.classList.contains(`lefts`)) {
          const theId = e.target.parentNode.dataset.id;
          // console.log(theId);
          // 调用删除
          axios({
            url: `https://hmajax.itheima.net/api/books/${theId}`,
            method: `delete`,
          }).then(() => {
            getBookList();
          });
        }
      });
      // 编辑
      const bianji = document.querySelector(`.rights`);
      document.querySelector(`.tbody`).addEventListener(`click`, (e) => {
        if (e.target.classList.contains(`rights`)) {
          const theIds = e.target.parentNode.dataset.id;
          // console.log(theIds);

          show();
          axios({
            url: `https://hmajax.itheima.net/api/books/${theIds}`,
          }).then((result) => {
            // console.log(result);
            const bookls = result.data.data;
            document.querySelector(`.inputsss`).value = bookls.bookname;
            document.querySelector(`.author`).value = bookls.author;
            document.querySelector(`.publisher`).value = bookls.publisher;
            // console.log(bookls);

            // second(貌似还有点问题)
            // const keys = Object.keys(bookls);
            // keys.forEach((key) => {
            //   document.querySelector(`.{key}`).value = bookls[key];
            // });
          });
          quxiao.addEventListener(`click`, () => {
            const forms = document.querySelector(`.shuru`);
            forms.reset();
            def();
          });
          xs.addEventListener(`click`, () => {
            const forms = document.querySelector(`.shuru`);
            forms.reset();
            def();
          });
          const queding = document.querySelector(`.queding`);
          queding.addEventListener(`click`, () => {
            const editForm = document.querySelector(`.shuru`);
            const { xuhao, bookname, author, publisher } = serialize(editForm, {
              hash: true,
              empty: true,
            });
            axios({
              url: `https://hmajax.itheima.net/api/books/${bookname}`,
              method: `put`,
              data: {
                bookname,
                author,
                publisher,
                creator,
              },
            }).then(() => {
              getBookList();
              forms.reset();
              def();
            });
          });
        }
      });
    </script>
  </body>
</html>
